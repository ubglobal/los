# Ph√¢n t√≠ch N√¢ng c·∫•p H·ªá th·ªëng LOS v2.0 ‚Üí v3.0

**Ng√†y:** 30/10/2025
**Phi√™n b·∫£n hi·ªán t·∫°i:** v2.0 (Security-Hardened)
**Phi√™n b·∫£n m·ª•c ti√™u:** v3.0 (Full LOS BA Specification)

---

## üìä T·ªîNG QUAN

### H·ªá th·ªëng hi·ªán t·∫°i (v2.0)
- ‚úÖ Quy tr√¨nh ph√™ duy·ªát t√≠n d·ª•ng c∆° b·∫£n (4 roles: CVQHKH ‚Üí CVTƒê ‚Üí CPD ‚Üí GDK)
- ‚úÖ Qu·∫£n l√Ω kh√°ch h√†ng (c√° nh√¢n & doanh nghi·ªáp)
- ‚úÖ Qu·∫£n l√Ω TSBƒê (collaterals)
- ‚úÖ Upload/qu·∫£n l√Ω t√†i li·ªáu
- ‚úÖ Thao t√°c workflow c∆° b·∫£n (Save, Approve, Reject, Return)
- ‚úÖ Security score 95% (CSRF, IDOR, Session, Rate Limit)
- ‚úÖ Admin area ho√†n ch·ªânh

### Y√™u c·∫ßu n√¢ng c·∫•p (v3.0 - theo BA)
- ‚ûï **Quy tr√¨nh Gi·∫£i ng√¢n** (ho√†n to√†n m·ªõi)
- ‚ûï **H·ªá th·ªëng H·∫°n m·ª©c (Facilities)**
- ‚ûï **Ngo·∫°i l·ªá & Khi·∫øu n·∫°i (Exceptions & Escalation)**
- ‚ûï **Qu·∫£n l√Ω HSTD sau ph√™ duy·ªát**
- ‚ûï **Tr·∫°ng th√°i n√¢ng cao** ("ƒê√£ c√≥ hi·ªáu l·ª±c", TSBƒê ƒë√£ k√≠ch ho·∫°t)
- ‚ûï **Thao t√°c workflow n√¢ng cao** (Discard, Escalate, Close, Request Info n√¢ng cao)
- ‚ûï **Ph√¢n quy·ªÅn chi ti·∫øt** (Access/Input/Update/Delete/Approve + Access to resources)
- ‚ûï **Audit log chi ti·∫øt** v·ªõi l·ªãch s·ª≠ ƒë·∫ßy ƒë·ªß
- ‚ûï **UI/UX chu·∫©n LOS** (3-zone layout, status bar)
- ‚ûï **QR Code cho t√†i li·ªáu** (optional)
- ‚ûï **SLA & C·∫£nh b√°o** (optional)

---

## üîç GAP ANALYSIS CHI TI·∫æT

### 1. DATABASE SCHEMA

#### ‚úÖ ƒê√£ c√≥ (v2.0)
```sql
users                           -- ƒê·∫ßy ƒë·ªß v·ªõi role, branch, approval_limit
customers                       -- C√° nh√¢n & doanh nghi·ªáp
products                        -- S·∫£n ph·∫©m t√≠n d·ª•ng
collateral_types                -- Lo·∫°i TSBƒê
credit_applications             -- HSTD v·ªõi status, stage
customer_credit_ratings         -- X·∫øp h·∫°ng t√≠n d·ª•ng
customer_related_parties        -- Ng∆∞·ªùi li√™n quan
application_collaterals         -- TSBƒê c·ªßa HSTD
application_documents           -- T√†i li·ªáu
application_repayment_sources   -- Ngu·ªìn tr·∫£ n·ª£
application_history             -- L·ªãch s·ª≠ thao t√°c
```

#### ‚ùå C·∫ßn b·ªï sung (v3.0)

**1. Facilities (H·∫°n m·ª©c) - CRITICAL**
```sql
CREATE TABLE facilities (
    id INT PRIMARY KEY AUTO_INCREMENT,
    application_id INT NOT NULL,
    facility_code VARCHAR(50) UNIQUE NOT NULL,
    facility_type VARCHAR(100) NOT NULL,          -- Ng·∫Øn h·∫°n/D√†i h·∫°n/LC/BL
    amount DECIMAL(20,2) NOT NULL,
    disbursed_amount DECIMAL(20,2) DEFAULT 0,
    available_amount DECIMAL(20,2),               -- amount - disbursed_amount
    status ENUM('Pending', 'Active', 'Inactive', 'Closed') DEFAULT 'Pending',
    start_date DATE,
    end_date DATE,
    collateral_required BOOLEAN DEFAULT FALSE,
    collateral_activated BOOLEAN DEFAULT FALSE,   -- Quan tr·ªçng cho gi·∫£i ng√¢n
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (application_id) REFERENCES credit_applications(id)
);
```

**2. Disbursements (Gi·∫£i ng√¢n) - CRITICAL**
```sql
CREATE TABLE disbursements (
    id INT PRIMARY KEY AUTO_INCREMENT,
    disbursement_code VARCHAR(50) UNIQUE NOT NULL,
    application_id INT NOT NULL,
    facility_id INT NOT NULL,
    amount DECIMAL(20,2) NOT NULL,
    purpose TEXT,
    beneficiary_account VARCHAR(50),
    beneficiary_name VARCHAR(255),
    status ENUM('Draft', 'Pending', 'Approved', 'Rejected', 'Disbursed') DEFAULT 'Draft',
    stage VARCHAR(100),                            -- B∆∞·ªõc workflow
    assigned_to_id INT,
    created_by_id INT NOT NULL,
    approved_by_id INT,
    disbursement_date DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (application_id) REFERENCES credit_applications(id),
    FOREIGN KEY (facility_id) REFERENCES facilities(id),
    FOREIGN KEY (assigned_to_id) REFERENCES users(id),
    FOREIGN KEY (created_by_id) REFERENCES users(id),
    FOREIGN KEY (approved_by_id) REFERENCES users(id)
);
```

**3. Disbursement Conditions (ƒêi·ªÅu ki·ªán gi·∫£i ng√¢n)**
```sql
CREATE TABLE disbursement_conditions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    disbursement_id INT NOT NULL,
    condition_text TEXT NOT NULL,
    is_mandatory BOOLEAN DEFAULT TRUE,
    is_met BOOLEAN DEFAULT FALSE,
    met_date DATE,
    met_by_id INT,
    notes TEXT,
    FOREIGN KEY (disbursement_id) REFERENCES disbursements(id),
    FOREIGN KEY (met_by_id) REFERENCES users(id)
);
```

**4. Approval Conditions (ƒêi·ªÅu ki·ªán ph√™ duy·ªát)**
```sql
CREATE TABLE approval_conditions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    application_id INT NOT NULL,
    condition_text TEXT NOT NULL,
    is_mandatory BOOLEAN DEFAULT TRUE,
    allow_exception BOOLEAN DEFAULT FALSE,        -- Cho ph√©p xin ngo·∫°i l·ªá
    is_exception_requested BOOLEAN DEFAULT FALSE,
    exception_reason TEXT,
    exception_approved BOOLEAN DEFAULT FALSE,
    exception_approved_by_id INT,
    exception_approved_date DATE,
    is_met BOOLEAN DEFAULT FALSE,
    met_date DATE,
    FOREIGN KEY (application_id) REFERENCES credit_applications(id),
    FOREIGN KEY (exception_approved_by_id) REFERENCES users(id)
);
```

**5. Escalations (Khi·∫øu n·∫°i/Leo thang)**
```sql
CREATE TABLE escalations (
    id INT PRIMARY KEY AUTO_INCREMENT,
    application_id INT,
    disbursement_id INT,
    escalation_type ENUM('Credit', 'Disbursement') NOT NULL,
    reason TEXT NOT NULL,
    escalated_by_id INT NOT NULL,
    escalated_to_id INT NOT NULL,
    status ENUM('Pending', 'Reviewing', 'Resolved', 'Rejected') DEFAULT 'Pending',
    resolution TEXT,
    resolved_by_id INT,
    resolved_date DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (application_id) REFERENCES credit_applications(id),
    FOREIGN KEY (disbursement_id) REFERENCES disbursements(id),
    FOREIGN KEY (escalated_by_id) REFERENCES users(id),
    FOREIGN KEY (escalated_to_id) REFERENCES users(id),
    FOREIGN KEY (resolved_by_id) REFERENCES users(id)
);
```

**6. Workflow Definitions (ƒê·ªãnh nghƒ©a quy tr√¨nh)**
```sql
CREATE TABLE workflow_steps (
    id INT PRIMARY KEY AUTO_INCREMENT,
    workflow_type ENUM('Credit_Approval', 'Disbursement') NOT NULL,
    step_name VARCHAR(100) NOT NULL,
    step_order INT NOT NULL,
    role_required VARCHAR(50) NOT NULL,
    approval_limit DECIMAL(20,2),                  -- H·∫°n m·ª©c ph√™ duy·ªát c·ªßa b∆∞·ªõc
    sla_hours INT,                                 -- SLA t√≠nh b·∫±ng gi·ªù
    is_active BOOLEAN DEFAULT TRUE
);
```

**7. Disbursement History (L·ªãch s·ª≠ gi·∫£i ng√¢n)**
```sql
CREATE TABLE disbursement_history (
    id INT PRIMARY KEY AUTO_INCREMENT,
    disbursement_id INT NOT NULL,
    user_id INT NOT NULL,
    action VARCHAR(100) NOT NULL,                  -- Save/Next/Request Info/Approve/Reject/Return/Escalate
    comment TEXT,
    from_stage VARCHAR(100),
    to_stage VARCHAR(100),
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (disbursement_id) REFERENCES disbursements(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

**8. Document History (L·ªãch s·ª≠ t√†i li·ªáu)**
```sql
CREATE TABLE document_history (
    id INT PRIMARY KEY AUTO_INCREMENT,
    document_id INT NOT NULL,
    action ENUM('Upload', 'Update', 'Delete', 'View') NOT NULL,
    old_file_path VARCHAR(255),
    new_file_path VARCHAR(255),
    changed_by_id INT NOT NULL,
    change_reason TEXT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (document_id) REFERENCES application_documents(id),
    FOREIGN KEY (changed_by_id) REFERENCES users(id)
);
```

**9. Enhanced Permissions (Ph√¢n quy·ªÅn n√¢ng cao)**
```sql
CREATE TABLE roles (
    id INT PRIMARY KEY AUTO_INCREMENT,
    role_name VARCHAR(50) UNIQUE NOT NULL,
    description TEXT
);

CREATE TABLE permissions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    module VARCHAR(50) NOT NULL,                   -- Credit, Disbursement, Customer, etc.
    permission_type ENUM('Access', 'Input', 'Update', 'Delete', 'Approve') NOT NULL,
    description TEXT
);

CREATE TABLE role_permissions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    role_id INT NOT NULL,
    permission_id INT NOT NULL,
    FOREIGN KEY (role_id) REFERENCES roles(id),
    FOREIGN KEY (permission_id) REFERENCES permissions(id),
    UNIQUE KEY unique_role_permission (role_id, permission_id)
);

CREATE TABLE user_branch_access (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    branch VARCHAR(100) NOT NULL,
    can_access_customers BOOLEAN DEFAULT FALSE,
    can_access_collaterals BOOLEAN DEFAULT FALSE,
    can_access_facilities BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

**10. QR Code Documents (Optional)**
```sql
ALTER TABLE application_documents ADD COLUMN (
    document_code VARCHAR(50),                     -- M√£ t√†i li·ªáu
    qr_token VARCHAR(255),                         -- Token t·ª´ QR code
    auto_classified BOOLEAN DEFAULT FALSE,         -- T·ª± ƒë·ªông ph√¢n lo·∫°i
    classification_confidence DECIMAL(3,2)         -- ƒê·ªô tin c·∫≠y (0.00-1.00)
);
```

**11. C·∫≠p nh·∫≠t b·∫£ng credit_applications**
```sql
ALTER TABLE credit_applications
ADD COLUMN effective_date DATE AFTER updated_at,           -- Ng√†y c√≥ hi·ªáu l·ª±c
ADD COLUMN legal_completed BOOLEAN DEFAULT FALSE,          -- Ho√†n t·∫•t ph√°p l√Ω
ADD COLUMN sla_due_date DATETIME,                          -- H·∫°n SLA
ADD COLUMN sla_status ENUM('On Track', 'Warning', 'Overdue') DEFAULT 'On Track',
ADD COLUMN workflow_type VARCHAR(50) DEFAULT 'Credit_Approval';
```

**12. C·∫≠p nh·∫≠t b·∫£ng application_collaterals**
```sql
ALTER TABLE application_collaterals
ADD COLUMN warehouse_status ENUM('Not Received', 'In Warehouse', 'Released') DEFAULT 'Not Received',
ADD COLUMN warehouse_date DATE,
ADD COLUMN facility_activated BOOLEAN DEFAULT FALSE,
ADD COLUMN activation_date DATE;
```

---

### 2. BUSINESS LOGIC & WORKFLOW

#### ‚ùå C·∫ßn implement (v3.0)

**A. Quy tr√¨nh Gi·∫£i ng√¢n**
- Kh·ªüi t·∫°o h·ªì s∆° gi·∫£i ng√¢n t·ª´ HSTD ƒë√£ ph√™ duy·ªát
- Ki·ªÉm tra ƒëi·ªÅu ki·ªán ti√™n quy·∫øt:
  - HSTD status = "ƒê√£ c√≥ hi·ªáu l·ª±c" (effective_date NOT NULL AND legal_completed = TRUE)
  - N·∫øu c√≥ TSBƒê: warehouse_status = "In Warehouse" AND facility_activated = TRUE
  - Facility c√≥ available_amount ƒë·ªß
- Workflow: Save ‚Üí Next ‚Üí Request Info ‚Üí Approve/Reject/Return ‚Üí Disbursed
- C·∫≠p nh·∫≠t disbursed_amount v√† available_amount c·ªßa facility

**B. H·ªá th·ªëng H·∫°n m·ª©c (Facilities)**
- M·ªôt HSTD c√≥ nhi·ªÅu h·∫°n m·ª©c (1-n)
- M·ªói h·∫°n m·ª©c c√≥: lo·∫°i, s·ªë ti·ªÅn, tr·∫°ng th√°i, collateral_activated
- Gi·∫£i ng√¢n ph·∫£i g·∫Øn ƒë√∫ng facility_id
- Ki·ªÉm so√°t available_amount

**C. Ngo·∫°i l·ªá & Khi·∫øu n·∫°i**
- ƒêi·ªÅu ki·ªán ph√™ duy·ªát: is_mandatory, allow_exception
- RM c√≥ th·ªÉ xin ngo·∫°i l·ªá cho ƒëi·ªÅu ki·ªán allow_exception = TRUE
- Approver c√≥ th·ªÉ "Cho ph√©p ngo·∫°i l·ªá" (exception_approved = TRUE)
- Escalate: khi b·ªã reject, RM c√≥ th·ªÉ khi·∫øu n·∫°i l√™n c·∫•p cao h∆°n

**D. Qu·∫£n l√Ω HSTD sau ph√™ duy·ªát**
- M√†n h√¨nh ri√™ng: `/post_approval_management.php`
- Ch·ªâ cho ph√©p ch·ªânh s·ª≠a khi status = "ƒê√£ ph√™ duy·ªát" HO·∫∂C "ƒê√£ c√≥ hi·ªáu l·ª±c"
- C√≥ th·ªÉ c·∫≠p nh·∫≠t: facilities, collaterals, repayment_sources, conditions
- Xem l·ªãch s·ª≠ ph√™ duy·ªát ƒë·∫ßy ƒë·ªß

**E. Tr·∫°ng th√°i n√¢ng cao**
```
Workflow Credit:
Draft ‚Üí Ch·ªù th·∫©m ƒë·ªãnh ‚Üí Ch·ªù ph√™ duy·ªát ‚Üí ƒê√£ ph√™ duy·ªát ‚Üí ƒê√£ c√≥ hi·ªáu l·ª±c
                                              ‚Üì
                                         ƒê√£ t·ª´ ch·ªëi

Workflow Disbursement:
Draft ‚Üí Ki·ªÉm tra ƒëi·ªÅu ki·ªán ‚Üí Ch·ªù ph√™ duy·ªát ‚Üí ƒê√£ gi·∫£i ng√¢n
                                  ‚Üì
                             ƒê√£ t·ª´ ch·ªëi
```

**F. Thao t√°c workflow n√¢ng cao**
- Save: L∆∞u nh√°p
- Next: G·ª≠i b∆∞·ªõc ti·∫øp theo
- Request Info: Y√™u c·∫ßu b·ªï sung (tr·∫£ v·ªÅ b∆∞·ªõc tr∆∞·ªõc)
- Approve: Ph√™ duy·ªát
- Reject: T·ª´ ch·ªëi
- Return: Tr·∫£ l·∫°i b∆∞·ªõc tr∆∞·ªõc (kh√°c Request Info)
- Escalate: Khi·∫øu n·∫°i/Leo thang l√™n c·∫•p cao
- Discard: H·ªßy b·ªè h·ªì s∆°
- Close: ƒê√≥ng h·ªì s∆°

---

### 3. UI/UX IMPROVEMENTS

#### ‚ùå C·∫ßn redesign (v3.0)

**A. Layout chu·∫©n LOS (3-zone)**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Header Navigation + User Info                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Status Bar (HSTD Code, Status, SLA, Actions)          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ           ‚îÇ                                             ‚îÇ
‚îÇ    Tab    ‚îÇ         Content Area                        ‚îÇ
‚îÇ   List    ‚îÇ    (Form fields, tables, etc.)              ‚îÇ
‚îÇ           ‚îÇ                                             ‚îÇ
‚îÇ  - Th√¥ng  ‚îÇ                                             ‚îÇ
‚îÇ    tin KH ‚îÇ                                             ‚îÇ
‚îÇ  - TSBƒê   ‚îÇ                                             ‚îÇ
‚îÇ  - H·∫°n    ‚îÇ                                             ‚îÇ
‚îÇ    m·ª©c    ‚îÇ                                             ‚îÇ
‚îÇ  - T√†i    ‚îÇ                                             ‚îÇ
‚îÇ    li·ªáu   ‚îÇ                                             ‚îÇ
‚îÇ  - ƒêi·ªÅu   ‚îÇ                                             ‚îÇ
‚îÇ    ki·ªán   ‚îÇ                                             ‚îÇ
‚îÇ  - L·ªãch   ‚îÇ                                             ‚îÇ
‚îÇ    s·ª≠     ‚îÇ                                             ‚îÇ
‚îÇ           ‚îÇ                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**B. Workspace / T·∫°o y√™u c·∫ßu m·ªõi**
- Hi·ªÉn th·ªã danh s√°ch quy tr√¨nh theo ph√¢n quy·ªÅn
- 2 quy tr√¨nh ch√≠nh:
  1. Quy tr√¨nh Ph√™ duy·ªát T√≠n d·ª•ng
  2. Quy tr√¨nh Gi·∫£i ng√¢n
- Click ƒë·ªÉ kh·ªüi t·∫°o

**C. Action buttons chu·∫©n**
```
[Save] [Close] [Next] [Request Info] [Discard]
[Return] [Approve] [Reject] [Escalate]
```
Hi·ªÉn th·ªã theo role v√† b∆∞·ªõc workflow

**D. Status indicators**
- Visual status bar v·ªõi m√†u s·∫Øc:
  - üü¢ Green: Approved, Effective
  - üü° Yellow: Pending, In Progress
  - üî¥ Red: Rejected, Overdue
  - üîµ Blue: Draft
- SLA countdown timer
- Progress bar (workflow steps)

---

### 4. SECURITY & PERMISSIONS

#### ‚úÖ ƒê√£ c√≥ (v2.0)
- CSRF protection
- Session security
- Rate limiting
- IDOR protection
- Security headers

#### ‚ûï C·∫ßn n√¢ng c·∫•p (v3.0)
- Role-based permissions (Access/Input/Update/Delete/Approve)
- Resource-level permissions (Access to customer/collateral/facility)
- Branch-based access control
- Audit log chi ti·∫øt (m·ªçi thao t√°c)

---

## üìã IMPLEMENTATION ROADMAP

### Phase 1: Database Foundation (Tu·∫ßn 1)
- ‚úÖ T·∫°o migration files cho t·∫•t c·∫£ tables m·ªõi
- ‚úÖ Update existing tables v·ªõi columns m·ªõi
- ‚úÖ T·∫°o seed data cho testing
- ‚úÖ Test foreign key constraints

### Phase 2: Core Business Logic (Tu·∫ßn 2-3)
- ‚úÖ Implement Facilities management
- ‚úÖ Implement Disbursement workflow
- ‚úÖ Implement Exceptions & Escalations
- ‚úÖ Update Credit workflow v·ªõi tr·∫°ng th√°i m·ªõi

### Phase 3: UI/UX Redesign (Tu·∫ßn 4-5)
- ‚úÖ Redesign application_detail.php (3-zone layout)
- ‚úÖ Create disbursement_detail.php
- ‚úÖ Create post_approval_management.php
- ‚úÖ Create workspace.php (T·∫°o y√™u c·∫ßu m·ªõi)
- ‚úÖ Implement status bar component
- ‚úÖ Implement action buttons component

### Phase 4: Advanced Features (Tu·∫ßn 6)
- ‚úÖ Enhanced permissions system
- ‚úÖ Detailed audit logging
- ‚úÖ SLA tracking & alerts (optional)
- ‚úÖ QR code integration (optional)

### Phase 5: Testing & Documentation (Tu·∫ßn 7)
- ‚úÖ Unit testing
- ‚úÖ Integration testing
- ‚úÖ UAT v·ªõi case scenarios t·ª´ BA
- ‚úÖ User guide & documentation

---

## üéØ MVP SCOPE (Minimum Viable Product)

### Must Have (Release v3.0)
1. ‚úÖ Facilities management
2. ‚úÖ Disbursement workflow (full)
3. ‚úÖ Exceptions & Escalations
4. ‚úÖ Post-approval management
5. ‚úÖ Enhanced status tracking
6. ‚úÖ 3-zone UI layout
7. ‚úÖ All action buttons (Save/Next/Request/Approve/Reject/Return/Escalate/Discard/Close)
8. ‚úÖ Basic audit logging

### Should Have (Release v3.1)
1. ‚úÖ Advanced permissions (Access/Input/Update/Delete/Approve)
2. ‚úÖ Branch-based access control
3. ‚úÖ SLA tracking
4. ‚úÖ Detailed audit logs with search

### Nice to Have (Release v3.2)
1. ‚ûï QR code document classification
2. ‚ûï SLA alerts & notifications
3. ‚ûï Dashboard v·ªõi charts
4. ‚ûï Mobile responsive design
5. ‚ûï Export reports (PDF/Excel)

---

## üß™ TEST CASES (UAT)

### Case 1: Vay ti√™u d√πng c√≥ TSBƒê (End-to-End)
1. RM t·∫°o HSTD ‚Üí Upload t√†i li·ªáu ‚Üí Xin ngo·∫°i l·ªá 1 ƒëi·ªÅu ki·ªán
2. CVTƒê th·∫©m ƒë·ªãnh ‚Üí Next
3. CPD/GDK "Cho ph√©p ngo·∫°i l·ªá" ‚Üí Approve
4. HSTD chuy·ªÉn sang "ƒê√£ ph√™ duy·ªát"
5. Admin ƒë√°nh d·∫•u TSBƒê "ƒë√£ nh·∫≠p kho" + k√≠ch ho·∫°t facility
6. Admin ƒë√°nh d·∫•u "ƒê√£ c√≥ hi·ªáu l·ª±c" (legal_completed = TRUE, effective_date = TODAY)
7. RM t·∫°o h·ªì s∆° gi·∫£i ng√¢n
8. Ki·ªÉm so√°t ki·ªÉm tra ƒëi·ªÅu ki·ªán ‚Üí Next
9. Th·ªß qu·ªπ Approve ‚Üí Gi·∫£i ng√¢n th√†nh c√¥ng
10. Ki·ªÉm tra disbursed_amount v√† available_amount ƒë√£ c·∫≠p nh·∫≠t

### Case 2: Vay t√≠n ch·∫•p b·ªã Return/Reject v·ªõi Escalate
1. RM t·∫°o HSTD ‚Üí Next
2. CVTƒê Return y√™u c·∫ßu b·ªï sung
3. RM Request Info v·ªÅ b∆∞·ªõc tr∆∞·ªõc ‚Üí B·ªï sung ‚Üí Next
4. CVTƒê OK ‚Üí Next
5. CPD Reject
6. RM Escalate l√™n GDK
7. GDK xem x√©t ‚Üí Approve override
8. HSTD chuy·ªÉn "ƒê√£ ph√™ duy·ªát"

### Case 3: ƒêi·ªÅu ch·ªânh sau ph√™ duy·ªát
1. Login Admin
2. V√†o "Qu·∫£n l√Ω HSTD" ‚Üí Ch·ªçn HSTD ƒë√£ ph√™ duy·ªát
3. Ch·ªânh s·ª≠a ngu·ªìn tr·∫£ n·ª£
4. Th√™m TSBƒê b·ªï sung
5. C·∫≠p nh·∫≠t facility amount
6. Xem l·ªãch s·ª≠ ph√™ duy·ªát ƒë·∫ßy ƒë·ªß
7. Verify audit log ghi ƒë·ªß th√¥ng tin

---

## üíæ FILES TO CREATE/MODIFY

### New Files (19 files)
```
migrations/
  ‚îú‚îÄ‚îÄ 001_create_facilities.sql
  ‚îú‚îÄ‚îÄ 002_create_disbursements.sql
  ‚îú‚îÄ‚îÄ 003_create_disbursement_conditions.sql
  ‚îú‚îÄ‚îÄ 004_create_approval_conditions.sql
  ‚îú‚îÄ‚îÄ 005_create_escalations.sql
  ‚îú‚îÄ‚îÄ 006_create_workflow_steps.sql
  ‚îú‚îÄ‚îÄ 007_create_disbursement_history.sql
  ‚îú‚îÄ‚îÄ 008_create_document_history.sql
  ‚îú‚îÄ‚îÄ 009_create_roles_permissions.sql
  ‚îú‚îÄ‚îÄ 010_alter_credit_applications.sql
  ‚îú‚îÄ‚îÄ 011_alter_application_collaterals.sql
  ‚îî‚îÄ‚îÄ 012_alter_application_documents.sql

includes/
  ‚îú‚îÄ‚îÄ workflow_engine.php         # Core workflow logic
  ‚îú‚îÄ‚îÄ facility_functions.php      # Facility management
  ‚îú‚îÄ‚îÄ disbursement_functions.php  # Disbursement functions
  ‚îî‚îÄ‚îÄ permission_functions.php    # Permission checking

components/
  ‚îú‚îÄ‚îÄ status_bar.php              # Status bar component
  ‚îú‚îÄ‚îÄ action_buttons.php          # Action buttons component
  ‚îî‚îÄ‚îÄ tab_navigation.php          # Tab navigation component

workspace.php                      # T·∫°o y√™u c·∫ßu m·ªõi
disbursement_detail.php            # Chi ti·∫øt gi·∫£i ng√¢n
post_approval_management.php       # Qu·∫£n l√Ω HSTD sau ph√™ duy·ªát
```

### Modified Files (8 files)
```
application_detail.php             # Redesign 3-zone layout
process_action.php                 # Add new actions
create_application.php             # Add facilities, conditions
index.php                          # Update dashboard
admin/manage_facilities.php        # Admin facility management
includes/functions.php             # Add new helper functions
includes/header.php                # Add workspace link
database.sql                       # Full schema v3.0
```

---

## üìä ESTIMATED EFFORT

| Phase | Tasks | Effort | Priority |
|-------|-------|--------|----------|
| Phase 1: Database | 12 migrations | 2 days | P0 |
| Phase 2: Core Logic | Facilities + Disbursement + Exceptions | 5 days | P0 |
| Phase 3: UI/UX | Redesign 5 pages + components | 5 days | P0 |
| Phase 4: Advanced | Permissions + Audit + SLA | 3 days | P1 |
| Phase 5: Testing | UAT + Documentation | 3 days | P0 |
| **TOTAL** | | **18 days** | |

---

## ‚úÖ ACCEPTANCE CRITERIA

### Functional Requirements
- [ ] C√≥ th·ªÉ t·∫°o v√† qu·∫£n l√Ω nhi·ªÅu h·∫°n m·ª©c cho 1 HSTD
- [ ] C√≥ th·ªÉ t·∫°o h·ªì s∆° gi·∫£i ng√¢n t·ª´ HSTD ƒë√£ c√≥ hi·ªáu l·ª±c
- [ ] H·ªá th·ªëng ch·∫∑n gi·∫£i ng√¢n khi ƒëi·ªÅu ki·ªán ch∆∞a ƒë√°p ·ª©ng
- [ ] C√≥ th·ªÉ xin ngo·∫°i l·ªá v√† duy·ªát ngo·∫°i l·ªá
- [ ] C√≥ th·ªÉ Escalate khi b·ªã reject
- [ ] C√≥ th·ªÉ qu·∫£n l√Ω HSTD sau ph√™ duy·ªát
- [ ] T·∫•t c·∫£ 9 action buttons ho·∫°t ƒë·ªông ƒë√∫ng theo role
- [ ] Audit log ghi ƒë·ªß m·ªçi thao t√°c

### Non-functional Requirements
- [ ] Performance: < 2s load time cho m·ªçi trang
- [ ] Security: Maintain 95% security score
- [ ] Usability: Sinh vi√™n c√≥ th·ªÉ ho√†n th√†nh UAT cases kh√¥ng c·∫ßn h·ªó tr·ª£
- [ ] Maintainability: Code c√≥ comments ƒë·∫ßy ƒë·ªß
- [ ] Compatibility: Works on Chrome, Firefox, Safari

---

## üöÄ NEXT STEPS

1. **Review & Approval** - Xem x√©t v√† ph√™ duy·ªát ph√¢n t√≠ch n√†y
2. **Phase 1 Start** - B·∫Øt ƒë·∫ßu t·∫°o database migrations
3. **Iterative Development** - Develop theo t·ª´ng phase, test li√™n t·ª•c
4. **UAT** - Test v·ªõi case scenarios t·ª´ BA
5. **Production Deployment** - Deploy l√™n production

---

**Prepared by:** Claude AI
**Date:** 30/10/2025
**Status:** Pending Approval
